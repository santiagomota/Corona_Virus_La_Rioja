(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{14:function(e,t,o){var n=o(4),r=o(17);e.exports=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?r(e):t}},15:function(e,t){function o(t){return e.exports=o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(t)}e.exports=o},16:function(e,t,o){var n=o(18);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},17:function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},25:function(e,t,o){"use strict";o.r(t);var n=o(20),r=o.n(n),i=o(2),s=o.n(i),c=o(3),a=o.n(c),m=o(14),u=o.n(m),l=o(15),d=o.n(l),f=o(16),g=o.n(f),v=o(0),p=o(1),h=Voonto.$,y=function(e){function t(){var e;if(s()(this,t),(e=u()(this,d()(t).apply(this,arguments))).options=v.Base.app().lookup("vocento.config.paywall.options"),e.mediaHasRestrictions=e.options.applyRestrictions,e.gigyaUX=null,e.userType="",e.canAddTags=!1,e.commentsAllowed=!0,e.hasPremiumConfig=!1,e.tagTypes=[p.d.subscriber,p.d.trial,p.d.journalist],e.isFirstComment=!1,e.isBlog=-1!==document.location.href.indexOf("//blogs."),!e.options)throw new Error("Can not find options parameters");return e}return g()(t,e),a()(t,[{key:"run",value:function(e){e&&(this.gigyaUX=e,this.isFirstComment=e.isFirstComment(),this.userType=e.getUserType(),this._buildSettings(),this._boxVisibilityTrigger(),this._onCommentsLoad(),this._onCommentsFetch(),this._onBeforeSubmit(),this._onSubmitted())}},{key:"cantNotCommentMessage",value:function(e){var t=v.Base.websiteConfig(),o="pro"===t.env?"":t.env+"-",n="https://".concat(o,"secure.").concat(t.tlddomain,"/login/login.html"),r=this.options.urlSubscribe,i=['<a class="voc-comments-form__btn voc-comments-form__btn--primary" id="subscribe-login" href="'.concat(n,'">Inicia sesión</a>'),'<a class="voc-comments-form__btn voc-comments-form__btn--secondary" id="subscribe-logged" href="'.concat(r,'">Suscríbete</a>')];e||i.shift();var s=document.createElement("div");return s.classList.add("container","voc-comments-form","voc-comments-form--disabled"),s.innerHTML='<p class="voc-comments-form__literal">Los comentarios son exclusivos para suscriptores. Participa en la conversación con nuestros periodistas</p>\n      <div class="voc-comments-form__btns-container">'.concat(i.join(""),"</div>"),s}},{key:"_onCommentsLoad",value:function(){var e=this;v.Base.app().on("vocuser:comments:load",(function(t,o){setTimeout((function(){return e._addEventListener()}),920),e._fixOrderBoxPosition(o),e._parseThreads(),e._onShowMoreComments()}))}},{key:"_onCommentsFetch",value:function(){var e=this;v.Base.app().on("vocuser:comments:fetch",(function(){var t=document.querySelector("div[data-toggle][data-target]").getAttribute("data-target");h("".concat(t)).on("shown.bs.collapse",(function(){e._parseThreads(),e._fixOrderBoxPosition(document),e._onShowMoreComments(),e.hasPremiumConfig&&e._onPrintListener();var t=document.querySelectorAll(".gig-comment-body");e._observeDOM(t)}))}))}},{key:"_onBeforeSubmit",value:function(){var e=this;v.Base.app().on("vocuser:comments:before-comment-submitted",(function(t,o){e.canAddTags&&(o.tags=[e.userType]);var n={comment:o.commentText,role:[e.userType]};o.commentText=JSON.stringify(n),e.userType!==p.d.subscriber||e.isFirstComment||e._registerCustomerService()}))}},{key:"_onSubmitted",value:function(){var e=this;v.Base.app().on("vocuser:comments:comment-submitted",(function(t,o){var n=o.comment.ID,r=document.querySelector('[data-comment-id="'.concat(n,'"]'));if(r){var i=r.querySelector(".gig-comment-body");i&&(e._observeDOM([i]),e._parseSingleThread(i))}}))}},{key:"_onSortComments",value:function(){var e=this,t=document.querySelectorAll(".gig-comments-sortbox li");r()(t).forEach((function(t){t.addEventListener("click",(function(){document.querySelector(".gig-comments-comments").addEventListener("DOMSubtreeModified",(function(){return e._parseThreads()}))}))}))}},{key:"_onShowMoreComments",value:function(){var e=this,t=document.querySelector(".gig-comments-more.voc-comments-more");t&&t.addEventListener("click",(function(){document.querySelector(".gig-comments-comments").addEventListener("DOMSubtreeModified",(function(){return e._parseThreads()}))}))}},{key:"_registerCustomerService",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=v.Base.app().lookup("vocento.site.content.section");if(!0!==e){if(t&&!this.isBlog){var o=this.userType===p.d.anonymous;v.Base.setCustomerService(this.gigyaUX,110,t,o)}}else v.Base.writeCustomerService(110,t)}},{key:"_onPrintListener",value:function(){this.userType===p.d.anonymous||null===this.commentsAllowed?this._printCanNotCommentMessage(!0):this.commentsAllowed||-1!==this.tagTypes.indexOf(this.userType)||this._printCanNotCommentMessage(!1)}},{key:"_printCanNotCommentMessage",value:function(e){var t=this,o=document.querySelector(".voc-comments-form");if(o){var n=this.cantNotCommentMessage(e);o.parentNode.insertBefore(n,o.nextSibling),o.parentNode.removeChild(o),this._commentRemoveElements()}else setTimeout((function(){return t._printCanNotCommentMessage(e)}),50)}},{key:"_parseThreads",value:function(){var e=this,t=document.querySelectorAll(".gig-comment-body");0===t.length&&setTimeout((function(){return e._parseThreads()}),50),r()(t).forEach((function(t){e._parseSingleThread(t)}))}},{key:"_parseSingleThread",value:function(e){try{var t=JSON.parse(e.innerHTML);if(e.classList.add("comment-on2-enabled"),e.innerHTML=t.comment,this.hasPremiumConfig&&Array.isArray(t.role)){var o=this._getParentBySelector(element$,"voc-comments-name");this._addTag(t,o)}}catch(e){}}},{key:"_addTag",value:function(e,t){if(t){var o=t.querySelector(".gig-comment-username");if(o){var n=document.createElement("span");e.role.indexOf(p.d.journalist)>-1?n.classList.add("sign-on2-comments-journalist"):n.classList.add("sign-on2-comments"),null===o.querySelector(".sign-on2-comments")&&null===o.querySelector(".sign-on2-comments-journalist")&&this.mediaHasRestrictions&&o.appendChild(n)}}}},{key:"_getParentBySelector",value:function(e,t){for(var o=e.parentNode;!o.classList.contains(t)||"body"===o.tagName.toLowerCase();)o=o.parentNode;return"body"!==o.tagName.toLowerCase()&&o}},{key:"_commentRemoveElements",value:function(){var e=document.querySelector(".voc-comments-opinion"),t=!!e&&e.querySelectorAll(".gig-comment-replybox, .voc-social-right");t&&r()(t).forEach((function(e){e.parentNode.removeChild(e)}));var o=document.querySelectorAll(".gig-comment-replyLink");r()(o).forEach((function(e){var t=document.createElement("a");t.classList.add("--no-reply","voc-reply"),t.innerText="Responder",e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e)}));var n=document.querySelectorAll(".--no-reply");r()(n).forEach((function(e){return e.addEventListener("click",(function(e){e.preventDefault(),h("html, body").animate({scrollTop:h(".voc-comments-block").offset().top-10},1e3)}))}))}},{key:"_observeDOM",value:function(e){var t=this;0!==e.length?r()(e).forEach((function(e){e.hasAttribute("data-event")||(e.setAttribute("data-event","true"),e.addEventListener("DOMSubtreeModified",(function(e){e.currentTarget&&t._parseSingleThread(e.currentTarget)})))})):setTimeout((function(){e=document.querySelectorAll(".gig-comment-body"),t._observeDOM(e)}),50)}},{key:"_boxVisibilityTrigger",value:function(){var e=document.querySelector(".voc-comments-title"),t=document.querySelector("#comments-container");e&&t&&e.addEventListener("click",(function(e){e.preventDefault(),t.children.length||v.Base.app().trigger("vocuser:comments:fetch")})),this._triggerUsingHash()}},{key:"_triggerUsingHash",value:function(){document.location.hash.slice(1).split("&").forEach((function(e){"comments"===e&&setTimeout((function(){document.querySelector(".voc-comments-title").click()}),2040)}))}},{key:"_fixOrderBoxPosition",value:function(e){var t=this,o=e.querySelector(".gig-comments-sort");o&&o.addEventListener("click",(function(){var e=t._offset(o),n="".concat(e.top+7,"px"),r="".concat(e.left+80,"px"),i=document.querySelector(".gig-comments-container.gig-comments-sortbox");i&&(i.classList.add("gig-comments-sortbox-transition"),i.style.cssText+="top: ".concat(n,"; left: ").concat(r),o.hasAttribute("data-event")||(o.setAttribute("data-event","true"),t._onSortComments()))}))}},{key:"_offset",value:function(e){var t=e.getBoundingClientRect();if(t.width||t.height||e.getClientRects().length){var o=e.ownerDocument.documentElement;return{top:t.top+window.pageYOffset-o.clientTop,left:t.left+window.pageXOffset-o.clientLeft}}}},{key:"_buildSettings",value:function(){var e=v.Base.app().lookup("vocento.config.vocuser.comments.premiumComments");this.isBlog||"boolean"!=typeof e||(this.commentsAllowed=e,this.hasPremiumConfig=!0),this.hasPremiumConfig&&this.userType===p.d.register&&(this.commentsAllowed=!this.commentsAllowed),this.commentsAllowed&&(this.canAddTags=!0),this.userType===p.d.register&&this.commentsAllowed&&this.tagTypes.push(p.d.register)}},{key:"_addEventListener",value:function(){var e=this;if(document.querySelector(".gig-composebox-textarea")){var t=document.querySelector('.gig-composebox-site-login[role="button"]');t&&t.addEventListener("click",(function(){return e._registerCustomerService()}))}var o=document.getElementById("subscribe-logged");o&&o.addEventListener("click",(function(){return e._registerCustomerService(!0)}));var n=document.getElementById("subscribe-login");n&&n.addEventListener("click",(function(){return e._registerCustomerService()}))}}]),t}(v.Base);t.default=y}}]);